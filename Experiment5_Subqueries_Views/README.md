# Experiment 5: Subqueries and Views

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

**Question 1**
--
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose Address as Delhi
For example:

Result
ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
2           Khilan      25          Delhi       1500

```
SELECT
    * 
FROM
    CUSTOMERS
WHERE
    ADDRESS = 'Delhi';

```

**Output:**



<img width="1016" height="264" alt="image" src="https://github.com/user-attachments/assets/6f944582-6b45-4d86-a49f-59d9bef72956" />


**Question 2**
---
Write a SQL query to Retrieve the names and cities of customers who have the same city as customers with IDs 3 and 7
For example:

Result
name   city
-----  ---------------
Neha   Bangalore
Rohit  Bangalore
Manoj  Bangalore
Vivek  Chandigarh


```
SELECT
    name,
    city
FROM
    customer
WHERE
    city IN (
        SELECT
            city
        FROM
            customer
        WHERE
            id IN (3, 7)
    );

```

**Output:**



<img width="488" height="367" alt="image" src="https://github.com/user-attachments/assets/8848cc52-6d1f-491b-af3c-a862ffe9e53c" />


**Question 3**
---
From the following tables write a SQL query to find all orders generated by London-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.
For example:

Result
ord_no      purch_amt   ord_date    customer_id  salesman_id
----------  ----------  ----------  -----------  -----------
70009       270.65      2012-09-10  3001         5005


```
SELECT
    T1.ord_no,
    T1.purch_amt,
    T1.ord_date,
    T1.customer_id,
    T1.salesman_id
FROM
    orders AS T1
INNER JOIN
    salesman AS T2 ON T1.salesman_id = T2.salesman_id
WHERE
    T2.city = 'London';

```

**Output:**



<img width="1309" height="330" alt="image" src="https://github.com/user-attachments/assets/cac3bce8-19bf-449d-a6f9-0806506d6304" />


**Question 4**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose AGE is LESS than $30
For example:

Result
ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
2           Khilan      25          Delhi       1500
3           Kaushik     23          Kota        2000
4           Chaitali    25          Mumbai      6500
5           Hardik      27          Bhopal      8500
6           Komal       22          Hyderabad   4500
7           Muffy       24          Indore      10000


```
SELECT
    * 
FROM
    CUSTOMERS
WHERE
    AGE < 30;

```

**Output:**



<img width="980" height="445" alt="image" src="https://github.com/user-attachments/assets/0bbb46a2-a453-426a-bb6b-5cab8aa36bad" />


**Question 5**
---
From the following tables write a SQL query to find all orders generated by New York-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.
For example:

Result
ord_no      purch_amt   ord_date    customer_id  salesman_id
----------  ----------  ----------  -----------  -----------
70002       65.26       2012-10-05  3002         5001
70005       2400.6      2012-07-27  3007         5001
70008       5760.0      2012-09-10  3002         5001
70013       3045.6      2012-04-25  3002         5001

```
SELECT
    T1.ord_no,
    T1.purch_amt,
    T1.ord_date,
    T1.customer_id,
    T1.salesman_id
FROM
    orders AS T1
INNER JOIN
    salesman AS T2 ON T1.salesman_id = T2.salesman_id
WHERE
    T2.city = 'New York';

```

**Output:**



<img width="1037" height="366" alt="image" src="https://github.com/user-attachments/assets/dd4f7ffa-0328-45df-9140-5415d5d21ff2" />


**Question 6**
---
Write a SQL query to Identify customers whose city is different from the city of the customer with the highest ID
For example:

Result
id     name             city             email            phone
-----  ---------------  ---------------  ---------------  ----------
6      Aarti Desai      Pune             aarti@gmail.com  890123456
7      Vivek Sharma     Chandigarh       vivek@gmail.com  980154021
8      Nisha Patel      Noida            nisha@gmail.com  901234567
9      Rajesh Singh     Hyderabad        rajesh@gmail.co  917654301

```
SELECT
    id,
    name,
    city,
    email,
    phone
FROM
    customer
WHERE
    city <> (
        SELECT
            city
        FROM
            customer
        WHERE
            id = (
                SELECT MAX(id) FROM customer
            )
    );

```

**Output:**



<img width="1180" height="385" alt="image" src="https://github.com/user-attachments/assets/59f08f21-eda1-4338-88d5-2bc6db406815" />


**Question 7**
---
Write a SQL query to Retrieve the names of customers who have a phone number that is not shared with any other customer.
For example:

Result
name
---------------
Aarti Desai
Vivek Sharma
Nisha Patel
Rajesh Singh
Radha Iyer


```
SELECT
    name
FROM
    customer
WHERE
    phone IN (
        SELECT
            phone
        FROM
            customer
        GROUP BY
            phone
        HAVING
            COUNT(phone) = 1
    );

```

**Output:**



<img width="437" height="365" alt="image" src="https://github.com/user-attachments/assets/65c548ef-54ff-476f-8a0a-ea6c63929336" />


**Question 8**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is EQUAL TO $1500.
For example:

Result
ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
2           Khilan      25          Delhi       1500


```
SELECT
    ID,
    NAME,
    AGE,
    ADDRESS,
    SALARY
FROM
    CUSTOMERS
WHERE
    SALARY = 1500;
    
```

**Output:**



<img width="1010" height="265" alt="image" src="https://github.com/user-attachments/assets/70f9b9f0-7c7d-4c7c-a579-3021253ef31e" />


**Question 9**
---
Write a SQL query to List departments with names longer than the average length
For example:

Result
depar  department_name
-----  ---------------
5      Anesthesiologis


```
SELECT
    department_id,
    department_name
FROM
    Departments
WHERE
    LENGTH(department_name) > (
        SELECT
            AVG(LENGTH(department_name))
        FROM
            Departments
    );

```

**Output:**



<img width="546" height="321" alt="image" src="https://github.com/user-attachments/assets/67174683-9123-4ae9-9b58-3c5d41547c18" />


**Question 10**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is greater than $4500.
For example:

Result
ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------
4           Chaitali    25          Mumbai      6500
5           Hardik      27          Bhopal      8500
7           Muffy       24          Indore      10000


```
SELECT
    ID,
    NAME,
    AGE,
    ADDRESS,
    SALARY
FROM
    CUSTOMERS
WHERE
    SALARY > 4500;

```

**Output:**


<img width="1017" height="346" alt="image" src="https://github.com/user-attachments/assets/ca8e49b8-d8d4-40a2-9f41-3b9df133d7e0" />



## RESULT
Thus, the SQL queries to implement subqueries and views have been executed successfully.
